import atals_image from "./fontAtlas.png?url"


export interface AtlasMetaData {
	char: string;
	// [Ustart, Vstart, Uend, Vend]
	uv: [number, number, number, number];
	width: number;
	height: number;
	advance: number;
}

export async function createFontAtlasBindings(
	device: GPUDevice
): Promise<{ atlasBindGroupLayout: GPUBindGroupLayout, atlasBindGroup: GPUBindGroup }> {

	const response = await fetch(atals_image);
	const imageBlob = await response.blob();
	const fontAtlasImageBitmap: ImageBitmap = await createImageBitmap(imageBlob);


	const fontAtlasTexture = device.createTexture({
		size: [fontAtlasImageBitmap.width, fontAtlasImageBitmap.height, 1],
		format: 'rgba8unorm', // Passen Sie das Format Ihres Atlas an
		usage: GPUTextureUsage.TEXTURE_BINDING | GPUTextureUsage.COPY_DST,
	});

	device.queue.copyExternalImageToTexture(
		{ source: fontAtlasImageBitmap },
		{ texture: fontAtlasTexture },
		[fontAtlasImageBitmap.width, fontAtlasImageBitmap.height]
	);

	const fontAtlasTextureView = fontAtlasTexture.createView();

	const fontAtlasSampler = device.createSampler({
		magFilter: 'linear',
		minFilter: 'linear',
	});

	const atlasBindGroupLayout = device.createBindGroupLayout({
		label: 'Font Atlas Bind Group Layout (Group 1)',
		entries: [
			{ binding: 0, visibility: GPUShaderStage.FRAGMENT, sampler: { type: 'filtering' } },
			{ binding: 1, visibility: GPUShaderStage.FRAGMENT, texture: { sampleType: 'float', viewDimension: '2d' } },
		],
	});

	const atlasBindGroup = device.createBindGroup({
		label: 'Font Atlas Bind Group',
		layout: atlasBindGroupLayout,
		entries: [
			{ binding: 0, resource: fontAtlasSampler },
			{ binding: 1, resource: fontAtlasTextureView },
		],
	});

	return { atlasBindGroupLayout, atlasBindGroup };
}





export const FONTATLAS_METADATA: AtlasMetaData[] = [{"char":"a","uv":[0,0,0.1111111111111111,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"b","uv":[0.1111111111111111,0,0.2222222222222222,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"c","uv":[0.2222222222222222,0,0.3333333333333333,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"d","uv":[0.3333333333333333,0,0.4444444444444444,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"e","uv":[0.4444444444444444,0,0.5555555555555556,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"f","uv":[0.5555555555555556,0,0.6666666666666666,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"g","uv":[0.6666666666666666,0,0.7777777777777778,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"h","uv":[0.7777777777777778,0,0.8888888888888888,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"i","uv":[0.8888888888888888,0,1,0.1111111111111111],"width":32,"height":32,"advance":32},{"char":"j","uv":[0,0.1111111111111111,0.1111111111111111,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"k","uv":[0.1111111111111111,0.1111111111111111,0.2222222222222222,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"l","uv":[0.2222222222222222,0.1111111111111111,0.3333333333333333,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"m","uv":[0.3333333333333333,0.1111111111111111,0.4444444444444444,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"n","uv":[0.4444444444444444,0.1111111111111111,0.5555555555555556,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"o","uv":[0.5555555555555556,0.1111111111111111,0.6666666666666666,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"p","uv":[0.6666666666666666,0.1111111111111111,0.7777777777777778,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"q","uv":[0.7777777777777778,0.1111111111111111,0.8888888888888888,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"r","uv":[0.8888888888888888,0.1111111111111111,1,0.2222222222222222],"width":32,"height":32,"advance":32},{"char":"s","uv":[0,0.2222222222222222,0.1111111111111111,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"t","uv":[0.1111111111111111,0.2222222222222222,0.2222222222222222,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"u","uv":[0.2222222222222222,0.2222222222222222,0.3333333333333333,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"v","uv":[0.3333333333333333,0.2222222222222222,0.4444444444444444,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"w","uv":[0.4444444444444444,0.2222222222222222,0.5555555555555556,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"x","uv":[0.5555555555555556,0.2222222222222222,0.6666666666666666,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"y","uv":[0.6666666666666666,0.2222222222222222,0.7777777777777778,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"z","uv":[0.7777777777777778,0.2222222222222222,0.8888888888888888,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"A","uv":[0.8888888888888888,0.2222222222222222,1,0.3333333333333333],"width":32,"height":32,"advance":32},{"char":"B","uv":[0,0.3333333333333333,0.1111111111111111,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"C","uv":[0.1111111111111111,0.3333333333333333,0.2222222222222222,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"D","uv":[0.2222222222222222,0.3333333333333333,0.3333333333333333,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"E","uv":[0.3333333333333333,0.3333333333333333,0.4444444444444444,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"F","uv":[0.4444444444444444,0.3333333333333333,0.5555555555555556,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"G","uv":[0.5555555555555556,0.3333333333333333,0.6666666666666666,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"H","uv":[0.6666666666666666,0.3333333333333333,0.7777777777777778,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"I","uv":[0.7777777777777778,0.3333333333333333,0.8888888888888888,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"J","uv":[0.8888888888888888,0.3333333333333333,1,0.4444444444444444],"width":32,"height":32,"advance":32},{"char":"K","uv":[0,0.4444444444444444,0.1111111111111111,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"L","uv":[0.1111111111111111,0.4444444444444444,0.2222222222222222,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"M","uv":[0.2222222222222222,0.4444444444444444,0.3333333333333333,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"N","uv":[0.3333333333333333,0.4444444444444444,0.4444444444444444,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"O","uv":[0.4444444444444444,0.4444444444444444,0.5555555555555556,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"P","uv":[0.5555555555555556,0.4444444444444444,0.6666666666666666,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"Q","uv":[0.6666666666666666,0.4444444444444444,0.7777777777777778,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"R","uv":[0.7777777777777778,0.4444444444444444,0.8888888888888888,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"S","uv":[0.8888888888888888,0.4444444444444444,1,0.5555555555555556],"width":32,"height":32,"advance":32},{"char":"T","uv":[0,0.5555555555555556,0.1111111111111111,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"U","uv":[0.1111111111111111,0.5555555555555556,0.2222222222222222,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"V","uv":[0.2222222222222222,0.5555555555555556,0.3333333333333333,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"W","uv":[0.3333333333333333,0.5555555555555556,0.4444444444444444,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"X","uv":[0.4444444444444444,0.5555555555555556,0.5555555555555556,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"Y","uv":[0.5555555555555556,0.5555555555555556,0.6666666666666666,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"Z","uv":[0.6666666666666666,0.5555555555555556,0.7777777777777778,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"1","uv":[0.7777777777777778,0.5555555555555556,0.8888888888888888,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"2","uv":[0.8888888888888888,0.5555555555555556,1,0.6666666666666666],"width":32,"height":32,"advance":32},{"char":"3","uv":[0,0.6666666666666666,0.1111111111111111,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"4","uv":[0.1111111111111111,0.6666666666666666,0.2222222222222222,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"5","uv":[0.2222222222222222,0.6666666666666666,0.3333333333333333,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"6","uv":[0.3333333333333333,0.6666666666666666,0.4444444444444444,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"7","uv":[0.4444444444444444,0.6666666666666666,0.5555555555555556,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"8","uv":[0.5555555555555556,0.6666666666666666,0.6666666666666666,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"9","uv":[0.6666666666666666,0.6666666666666666,0.7777777777777778,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"0","uv":[0.7777777777777778,0.6666666666666666,0.8888888888888888,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":" ","uv":[0.8888888888888888,0.6666666666666666,1,0.7777777777777778],"width":32,"height":32,"advance":32},{"char":"!","uv":[0,0.7777777777777778,0.1111111111111111,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":".","uv":[0.1111111111111111,0.7777777777777778,0.2222222222222222,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":",","uv":[0.2222222222222222,0.7777777777777778,0.3333333333333333,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":":","uv":[0.3333333333333333,0.7777777777777778,0.4444444444444444,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":";","uv":[0.4444444444444444,0.7777777777777778,0.5555555555555556,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":"-","uv":[0.5555555555555556,0.7777777777777778,0.6666666666666666,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":"+","uv":[0.6666666666666666,0.7777777777777778,0.7777777777777778,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":"=","uv":[0.7777777777777778,0.7777777777777778,0.8888888888888888,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":"/","uv":[0.8888888888888888,0.7777777777777778,1,0.8888888888888888],"width":32,"height":32,"advance":32},{"char":"\\","uv":[0,0.8888888888888888,0.1111111111111111,1],"width":32,"height":32,"advance":32},{"char":"?","uv":[0.1111111111111111,0.8888888888888888,0.2222222222222222,1],"width":32,"height":32,"advance":32}]
